<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../favicon.png" />
		<meta name="viewport" content="width=device-width" />
		<meta name="author" content="Joachim KÃ¸cher Kelsen" />
		
		<link href="../_app/immutable/assets/0.B24Gem9j.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.GNtGQohH.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/UycSvYIy.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Db0b_LWK.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/F8UuGu_H.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DbJvz8S3.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.Bokif1t4.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/C9f0ZI4H.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BdD32qd5.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CUjF3E6N.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BpXGYBMw.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.DEaLcxks.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BOyCDzPS.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CANx_FtO.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BweDwWPv.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/D8S7Fiyf.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/hXpMuBZJ.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/2.Da4z7FR_.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/12.BiMt5W3F.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Dg6GzD5d.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BqXxNwWv.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DcIxqC40.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BL1phRJf.js"><!--[--><!--]--><title>DPoP</title>
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents"><!--[--><!--[--><!----><nav class="backdrop-saturate-200 backdrop-blur-md z-50 flex fixed top-0 bottom-0 left-0 right-0 overflow-y-auto hidden"><div class="w-full h-fit max-w-80 bg-zinc-200"><div class="px-4 pt-6"><button aria-label="Close mobile menu"><svg class="w-4 h-4" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <div><ul class="rounded-md [&amp;>li]:px-4 py-4 space-y-4 text-lg"><!--[--><li class="hover:underline"><a href="/authserver/intro">Intro</a></li><li class="hover:underline"><a href="/authserver/demo">Demo</a></li><li class="hover:underline"><a href="/authserver/developer">Developer</a></li><!--]--> <!--[--><li class="hover:underline"><a href="/authserver/developer/architecture">Architecture</a></li><li class="hover:underline"><a href="/authserver/developer/datamodel">Datamodel</a></li><li class="hover:underline"><a href="/authserver/developer/setup">Setup</a></li><li class="hover:underline"><a href="/authserver/developer/client-authentication">Client Authentication</a></li><li class="hover:underline"><a href="/authserver/developer/discovery">Discovery</a></li><li class="hover:underline"><a href="/authserver/developer/jwks">JWKS</a></li><li class="hover:underline"><a href="/authserver/developer/pkce">PKCE</a></li><li class="hover:underline"><a href="/authserver/developer/subject-type">Subject Type</a></li><li class="hover:underline"><a href="/authserver/developer/resource">Resource</a></li><li class="hover:underline"><a href="/authserver/developer/dpop">DPoP</a></li><li class="hover:underline"><a href="/authserver/developer/token">Token</a></li><li class="hover:underline"><a href="/authserver/developer/client-credentials">Client Credentials</a></li><li class="hover:underline"><a href="/authserver/developer/authorization-code">Authorization Code</a></li><li class="hover:underline"><a href="/authserver/developer/refresh-token">Refresh Token</a></li><li class="hover:underline"><a href="/authserver/developer/token-revocation">Token Revocation</a></li><li class="hover:underline"><a href="/authserver/developer/token-introspection">Token Introspection</a></li><li class="hover:underline"><a href="/authserver/developer/grant-management">Grant Management</a></li><!--]--></ul></div></div></nav> <nav class="bg-gray-100 py-5"><div class="max-w-7xl mx-auto px-4"><div class="items-center flex justify-between"><div class="flex space-x-4"><button class="lg:hidden" aria-label="Open mobile menu"><svg viewBox="0 0 24 24" class="w-4 h-4"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg></button> <div class="hidden lg:block"><a href="../" class="flex items-center text-gray-700 hover:text-gray-900"><svg class="h-6 w-6 mr-1 fill-openid" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.54 .887L10.91 2.66V20.83C6.76 20.31 3.64 18.05 3.64 15.33C3.64 12.75 6.44 10.58 10.27 9.92V7.61C4.42 8.32 0 11.5 0 15.33C0 19.29 4.74 22.57 10.91 23.11L14.54 21.4V.886M15.18 7.61V9.92C16.61 10.17 17.89 10.62 18.94 11.23L16.97 12.34L24 13.87L23.5 8.66L21.63 9.72C19.89 8.66 17.67 7.91 15.18 7.61Z"></path></svg> <span class="font-bold">AuthServer</span></a><!----></div></div> <div class="flex items-center space-x-1"><div class="block lg:hidden"><a href="../" class="flex items-center text-gray-700 hover:text-gray-900"><svg class="h-6 w-6 mr-1 fill-openid" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.54 .887L10.91 2.66V20.83C6.76 20.31 3.64 18.05 3.64 15.33C3.64 12.75 6.44 10.58 10.27 9.92V7.61C4.42 8.32 0 11.5 0 15.33C0 19.29 4.74 22.57 10.91 23.11L14.54 21.4V.886M15.18 7.61V9.92C16.61 10.17 17.89 10.62 18.94 11.23L16.97 12.34L24 13.87L23.5 8.66L21.63 9.72C19.89 8.66 17.67 7.91 15.18 7.61Z"></path></svg> <span class="font-bold">AuthServer</span></a><!----></div> <div class="hidden lg:block"><!--[--><a href="/authserver/intro" class="px-3 text-gray-700 hover:text-gray-900">Intro</a><a href="/authserver/demo" class="px-3 text-gray-700 hover:text-gray-900">Demo</a><a href="/authserver/developer" class="px-3 text-gray-700 hover:text-gray-900">Developer</a><!--]--></div></div> <div class="flex items-center space-x-1"><a href="https://github.com/jokk-itu/authserver" target="_blank"><img src="../github.svg" alt="Github" height="20px" width="20px"></a></div></div></div></nav><!----> <main class="container px-4 sm:mx-auto mt-8"><div class="w-full"><!----><!--[--><!----><div class="flex"><nav class="hidden lg:block sm:flex-none mx-4 w-56 rounded-md outline-8"><ul class="rounded-md [&amp;>li]:px-4 py-4 space-y-4 text-lg bg-zinc-200"><!--[--><li class="hover:underline"><a href="/authserver/developer/architecture">Architecture</a></li><li class="hover:underline"><a href="/authserver/developer/datamodel">Datamodel</a></li><li class="hover:underline"><a href="/authserver/developer/setup">Setup</a></li><li class="hover:underline"><a href="/authserver/developer/client-authentication">Client Authentication</a></li><li class="hover:underline"><a href="/authserver/developer/discovery">Discovery</a></li><li class="hover:underline"><a href="/authserver/developer/jwks">JWKS</a></li><li class="hover:underline"><a href="/authserver/developer/pkce">PKCE</a></li><li class="hover:underline"><a href="/authserver/developer/subject-type">Subject Type</a></li><li class="hover:underline"><a href="/authserver/developer/resource">Resource</a></li><li class="hover:underline"><a href="/authserver/developer/dpop">DPoP</a></li><li class="hover:underline"><a href="/authserver/developer/token">Token</a></li><li class="hover:underline"><a href="/authserver/developer/client-credentials">Client Credentials</a></li><li class="hover:underline"><a href="/authserver/developer/authorization-code">Authorization Code</a></li><li class="hover:underline"><a href="/authserver/developer/refresh-token">Refresh Token</a></li><li class="hover:underline"><a href="/authserver/developer/token-revocation">Token Revocation</a></li><li class="hover:underline"><a href="/authserver/developer/token-introspection">Token Introspection</a></li><li class="hover:underline"><a href="/authserver/developer/grant-management">Grant Management</a></li><!--]--></ul></nav> <div class="flex-auto w-full"><!----><!----><h1 class="text-4xl mb-2">DPoP</h1> <hr class="mb-4"><!----> <div class="mb-8" id="introduction"><div class="inline-flex"><a class="hover:underline ref-link text-xl" href="#introduction">Introduction</a></div> <hr class="mb-4"> <!----><p>Demonstrating Proof of Possession (DPoP) is a method to sender constraint tokens.
        It means the client that received the token from AuthServer at the token endpoint,
        is the only one that can send the token to protected resources.</p><!----></div><!----> <div class="mb-8" id="specifications"><div class="inline-flex"><a class="hover:underline ref-link text-xl" href="#specifications">Specifications</a></div> <hr class="mb-4"> <!----><div class="w-full overflow-x-auto"><table class="border-collapse table-fixed sm:table-auto w-full text-sm"><caption class="caption-bottom">Table 1: Specifications</caption><thead class="bg-openid"><tr><!--[--><th class="break-words border font-medium text-lg p-4 pl-8 pt-3 pb-3 text-left">Name</th><th class="break-words border font-medium text-lg p-4 pl-8 pt-3 pb-3 text-left">Description</th><!--]--></tr></thead><tbody class="bg-white"><!--[--><tr><!--[--><!--[--><td class="break-words border border-slate-200 p-4 pl-8"><a href="https://datatracker.ietf.org/doc/html/rfc9449" class="underline decoration-2 hover:decoration-openid">DPoP</a></td><!--]--><!--[!--><td class="break-words border border-slate-200 p-4 pl-8">Specification for sender constraining tokens using DPoP</td><!--]--><!--]--></tr><!--]--></tbody></table></div><!----></div><!----> <div class="mb-8" id="dpop flow"><div class="inline-flex"><a class="hover:underline ref-link text-xl" href="#dpop flow">DPoP flow</a></div> <hr class="mb-4"> <!----><p>Public and Confidential clients can use DPoP and is an optional addition to increase security and reduce misuse of tokens.</p> <br> <div class="p-4 my-2 rounded-lg bg-sky-700 font-medium text-cyan-200"><!----><!---->It is possible for public clients to use DPoP
        because the private key used for signing DPoP tokens is not associated with the client metadata used by AuthServer.<!----></div><!----> <br> <p>If a client uses DPoP then it is required in the entire flow when retrieving an access token.
        For the "authorization_code" grant type it means DPoP must be used during authorize and at the token endpoint.
        When requesting protected resources using a DPoP bound access token, it is always required to present a DPoP proof.</p> <br> <p>Access tokens and Refresh tokens can be DPoP bound.</p> <div class="p-4 my-2 rounded-lg bg-sky-700 font-medium text-cyan-200"><!----><!---->Only public clients will have their refresh tokens bound,
        because confidential clients have their refresh token bound using client authentication.<!----></div><!----> <br> <p>Even though DPoP is optional at AuthServer, then a client can require DPoP usage through its client metadata.
        Then if an endpoint that can accept DPoP usage, does not receive DPoP parameters in requests associated with the client,
        the request will fail.</p><!----></div><!----> <div class="mb-8" id="dpop token"><div class="inline-flex"><a class="hover:underline ref-link text-xl" href="#dpop token">DPoP token</a></div> <hr class="mb-4"> <!----><p>The DPoP token is a structured JWT and is signed using one of the algorithms from the discovery endpoint.
        The token can contain the fields in table 2.</p> <br> <div class="w-full overflow-x-auto"><table class="border-collapse table-fixed sm:table-auto w-full text-sm"><caption class="caption-bottom">Table 2: DPoP token fields</caption><thead class="bg-openid"><tr><!--[--><th class="break-words border font-medium text-lg p-4 pl-8 pt-3 pb-3 text-left">Name</th><th class="break-words border font-medium text-lg p-4 pl-8 pt-3 pb-3 text-left">Description</th><!--]--></tr></thead><tbody class="bg-white"><!--[--><tr><!--[--><!--[!--><td class="break-words border border-slate-200 p-4 pl-8">htm</td><!--]--><!--[!--><td class="break-words border border-slate-200 p-4 pl-8">HTTP method used at the request. This is a required claim.</td><!--]--><!--]--></tr><tr><!--[--><!--[!--><td class="break-words border border-slate-200 p-4 pl-8">htu</td><!--]--><!--[!--><td class="break-words border border-slate-200 p-4 pl-8">HTTP absolute URL used at the request. This is a required claim.</td><!--]--><!--]--></tr><tr><!--[--><!--[!--><td class="break-words border border-slate-200 p-4 pl-8">nonce</td><!--]--><!--[!--><td class="break-words border border-slate-200 p-4 pl-8">Server provided nonce. This is a required claim.</td><!--]--><!--]--></tr><tr><!--[--><!--[!--><td class="break-words border border-slate-200 p-4 pl-8">ath</td><!--]--><!--[!--><td class="break-words border border-slate-200 p-4 pl-8">Hash of the access token that is bound to the DPoP token. This is a required claim when requests use the bound access token.</td><!--]--><!--]--></tr><tr><!--[--><!--[!--><td class="break-words border border-slate-200 p-4 pl-8">jwk</td><!--]--><!--[!--><td class="break-words border border-slate-200 p-4 pl-8">Public JsonWebKey used to verify the signature of the DPoP token. This is a required header.</td><!--]--><!--]--></tr><tr><!--[--><!--[!--><td class="break-words border border-slate-200 p-4 pl-8">typ</td><!--]--><!--[!--><td class="break-words border border-slate-200 p-4 pl-8">Type of JsonWebToken. This is a required header and must be dpop+jwt.</td><!--]--><!--]--></tr><tr><!--[--><!--[!--><td class="break-words border border-slate-200 p-4 pl-8">jti</td><!--]--><!--[!--><td class="break-words border border-slate-200 p-4 pl-8">Unique identifier of the DPoP token. This is a required claim.</td><!--]--><!--]--></tr><tr><!--[--><!--[!--><td class="break-words border border-slate-200 p-4 pl-8">exp</td><!--]--><!--[!--><td class="break-words border border-slate-200 p-4 pl-8">Unix timestamp when the DPoP token expires. This is a required claim.</td><!--]--><!--]--></tr><tr><!--[--><!--[!--><td class="break-words border border-slate-200 p-4 pl-8">iat</td><!--]--><!--[!--><td class="break-words border border-slate-200 p-4 pl-8">Unix timestamp when the DPoP token was issued. This is a required claim.</td><!--]--><!--]--></tr><tr><!--[--><!--[!--><td class="break-words border border-slate-200 p-4 pl-8">nbf</td><!--]--><!--[!--><td class="break-words border border-slate-200 p-4 pl-8">Unix timestamp when the DPoP token is active from. This is a required claim.</td><!--]--><!--]--></tr><!--]--></tbody></table></div><!----> <br> <p>The following JSON example shows a base64 decoded DPoP token sent to the token endpoint.</p> <br> <div class="w-full overflow-x-auto"><div class="outline-solid bg-gray-900 border-slate-600 border-4 rounded-lg my-8"><pre class="whitespace-pre p-4 flex overflow-x-auto leading-6">            <code class="text-white pe-16">
                <!----><!---->
{
  "typ": "dpop+jwt",
  "alg": "ES256",
  "jwk":
  {
    "kty": "EC",
    "x": "l8tFrhx-34tV3hRICRDY9zCkDlpBhF42UQUfWVAWBFs",
    "y": "9VE4jf_Ok_o64zbTTlcuNJajHmt6v9TDVrU0CdvGRDA",
    "crv": "P-256"
  }
}
.
{
  "jti": "b1a4262d-89fb-4d5a-b662-f1b637241a88",
  "htm": "POST",
  "htu": "https://idp.authserver.dk/connect/token",
  "nonce": "eyJ7S_zG.eyJH0-Z.HX4w-7v",
  "iat": 1562262616,
  "nbf": 1562262616,
  "exp": 1562262676
}
        <!---->
            </code>
        </pre></div></div><!----> <br> <p>The following JSON example shows a base64 decoded DPoP token sent to a protected resource.</p> <div class="w-full overflow-x-auto"><div class="outline-solid bg-gray-900 border-slate-600 border-4 rounded-lg my-8"><pre class="whitespace-pre p-4 flex overflow-x-auto leading-6">            <code class="text-white pe-16">
                <!----><!---->
{
  "typ": "dpop+jwt",
  "alg": "ES256",
  "jwk":
  {
    "kty": "EC",
    "x": "l8tFrhx-34tV3hRICRDY9zCkDlpBhF42UQUfWVAWBFs",
    "y": "9VE4jf_Ok_o64zbTTlcuNJajHmt6v9TDVrU0CdvGRDA",
    "crv": "P-256"
  }
}
.
{
  "jti": "b1a4262d-89fb-4d5a-b662-f1b637241a88",
  "htm": "GET",
  "htu": "https://api.authserver.dk/data",
  "nonce": "eyJ7S_zG.eyJH0-Z.HX4w-7v",
  "ath":"fUHyO2r2Z3DZ53EsNrWBb0xWXoaNy59IiKCAqksmQEo",
  "iat": 1562262616,
  "nbf": 1562262616,
  "exp": 1562262676
}
        <!---->
            </code>
        </pre></div></div><!----><!----></div><!----> <div class="mb-8" id="dpop nonce"><div class="inline-flex"><a class="hover:underline ref-link text-xl" href="#dpop nonce">DPoP nonce</a></div> <hr class="mb-4"> <!----><p>The DPoP nonce is generated by the server and is used to make sure DPoP tokens cannot be made for the future,
        if the private key is leaked.</p> <p>The DPoP nonce is provided through error responses, when a DPoP token contains a missing nonce or a stale nonce.</p> <p>The lifetime of DPoP nonces are controlled by the client through its metadata.</p> <p>An example of a response containing a DPoP nonce can be seen below.</p> <div class="w-full overflow-x-auto"><div class="outline-solid bg-gray-900 border-slate-600 border-4 rounded-lg my-8"><pre class="whitespace-pre p-4 flex overflow-x-auto leading-6">            <code class="text-white pe-16">
                <!----><!---->
HTTP/1.1 400 Bad Request
Content-Type: application/json;charset=UTF-8
Cache-Control: no-cache, no-store
DPoP-Nonce: eyJ7S_zG.eyJH0-Z.HX4w-7v

{
  "error": "use_dpop_nonce",
  "error_description": "nonce is required for dpop"
}
        <!---->
            </code>
        </pre></div></div><!----><!----></div><!----><!----><!----></div></div><!----><!--]--><!----></div></main> <footer><svg viewBox="0 0 1440 320" class="fill-openid" xmlns="http://www.w3.org/2000/svg"><path fill-opacity="1" d="M0,128L34.3,112C68.6,96,137,64,206,74.7C274.3,85,343,139,411,149.3C480,160,549,128,617,106.7C685.7,85,754,75,823,96C891.4,117,960,171,1029,181.3C1097.1,192,1166,160,1234,165.3C1302.9,171,1371,213,1406,234.7L1440,256L1440,320L1405.7,320C1371.4,320,1303,320,1234,320C1165.7,320,1097,320,1029,320C960,320,891,320,823,320C754.3,320,686,320,617,320C548.6,320,480,320,411,320C342.9,320,274,320,206,320C137.1,320,69,320,34,320L0,320Z"></path></svg> <div class="bg-gray-800 text-white py-4"><div class="container mx-auto text-center"><p>2025 AuthServer. All rights reserved.</p></div></div></footer><!----><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_74rxo3 = {
						base: new URL("..", location).pathname.slice(0, -1),
						assets: "/authserver"
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../_app/immutable/entry/start.GNtGQohH.js"),
						import("../_app/immutable/entry/app.Bokif1t4.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2, 12],
							data: [null,null,null],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>