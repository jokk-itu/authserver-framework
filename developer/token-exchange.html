<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../favicon.png" />
		<meta name="viewport" content="width=device-width" />
		<meta name="author" content="Joachim KÃ¸cher Kelsen" />
		
		<link href="../_app/immutable/assets/0.BroPqEPu.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.CW53oebm.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/D5Dp0CL7.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Iw8VLsBB.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CmH-VLjb.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DdUG0Uhc.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.DkWigvru.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BC3K4fVT.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Z1HRfbhX.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/B7lg28Rm.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DqATkG3X.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.iHrbWAjK.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BQYPTkyu.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/kkZWmn4h.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Cd9-8Xz3.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/D5LSjsZ2.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Bwhf-QOO.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/2.CKtj4dXb.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/22.CFAN4r7W.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BhNhnXGn.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CVzv1ABR.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/D5cW4fPA.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DtqDFwhC.js"><!--a19h53--><!----><title>Token Exchange</title>
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents"><!--[--><!--[--><!----><nav class="backdrop-saturate-200 backdrop-blur-md z-50 flex fixed top-0 bottom-0 left-0 right-0 overflow-y-auto hidden"><div class="w-full h-fit max-w-80 bg-zinc-200"><div class="px-4 pt-6"><button aria-label="Close mobile menu"><svg class="w-4 h-4" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <div><ul class="rounded-md [&amp;>li]:px-4 py-4 space-y-4 text-lg"><!--[--><li class="hover:underline"><a href="/authserver/intro">Intro</a></li><li class="hover:underline"><a href="/authserver/demo">Demo</a></li><li class="hover:underline"><a href="/authserver/developer">Developer</a></li><!--]--> <!--[--><li class="hover:underline"><a href="/authserver/developer/architecture">Architecture</a></li><li class="hover:underline"><a href="/authserver/developer/setup">Setup</a></li><li class="hover:underline"><a href="/authserver/developer/client-authentication">Client Authentication</a></li><li class="hover:underline"><a href="/authserver/developer/discovery">Discovery</a></li><li class="hover:underline"><a href="/authserver/developer/jwks">JWKS</a></li><li class="hover:underline"><a href="/authserver/developer/pkce">PKCE</a></li><li class="hover:underline"><a href="/authserver/developer/subject-type">Subject Type</a></li><li class="hover:underline"><a href="/authserver/developer/resource">Resource</a></li><li class="hover:underline"><a href="/authserver/developer/jar">JAR</a></li><li class="hover:underline"><a href="/authserver/developer/dpop">DPoP</a></li><li class="hover:underline"><a href="/authserver/developer/token">Token</a></li><li class="hover:underline"><a href="/authserver/developer/client-credentials">Client Credentials</a></li><li class="hover:underline"><a href="/authserver/developer/authorization-code">Authorization Code</a></li><li class="hover:underline"><a href="/authserver/developer/refresh-token">Refresh Token</a></li><li class="hover:underline"><a href="/authserver/developer/token-exchange">Token Exchange</a></li><li class="hover:underline"><a href="/authserver/developer/device-authorization">Device Authorization</a></li><li class="hover:underline"><a href="/authserver/developer/token-revocation">Token Revocation</a></li><li class="hover:underline"><a href="/authserver/developer/token-introspection">Token Introspection</a></li><li class="hover:underline"><a href="/authserver/developer/grant-management">Grant Management</a></li><!--]--></ul></div></div></nav> <nav class="bg-gray-100 py-5"><div class="max-w-7xl mx-auto px-4"><div class="items-center flex justify-between"><div class="flex space-x-4"><button class="lg:hidden" aria-label="Open mobile menu"><svg viewBox="0 0 24 24" class="w-4 h-4"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg></button> <div class="hidden lg:block"><a href="../" class="flex items-center text-gray-700 hover:text-gray-900"><svg class="h-6 w-6 mr-1 fill-openid" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.54 .887L10.91 2.66V20.83C6.76 20.31 3.64 18.05 3.64 15.33C3.64 12.75 6.44 10.58 10.27 9.92V7.61C4.42 8.32 0 11.5 0 15.33C0 19.29 4.74 22.57 10.91 23.11L14.54 21.4V.886M15.18 7.61V9.92C16.61 10.17 17.89 10.62 18.94 11.23L16.97 12.34L24 13.87L23.5 8.66L21.63 9.72C19.89 8.66 17.67 7.91 15.18 7.61Z"></path></svg> <span class="font-bold">AuthServer</span></a><!----></div></div> <div class="flex items-center space-x-1"><div class="block lg:hidden"><a href="../" class="flex items-center text-gray-700 hover:text-gray-900"><svg class="h-6 w-6 mr-1 fill-openid" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.54 .887L10.91 2.66V20.83C6.76 20.31 3.64 18.05 3.64 15.33C3.64 12.75 6.44 10.58 10.27 9.92V7.61C4.42 8.32 0 11.5 0 15.33C0 19.29 4.74 22.57 10.91 23.11L14.54 21.4V.886M15.18 7.61V9.92C16.61 10.17 17.89 10.62 18.94 11.23L16.97 12.34L24 13.87L23.5 8.66L21.63 9.72C19.89 8.66 17.67 7.91 15.18 7.61Z"></path></svg> <span class="font-bold">AuthServer</span></a><!----></div> <div class="hidden lg:block"><!--[--><a href="/authserver/intro" class="px-3 text-gray-700 hover:text-gray-900">Intro</a><a href="/authserver/demo" class="px-3 text-gray-700 hover:text-gray-900">Demo</a><a href="/authserver/developer" class="px-3 text-gray-700 hover:text-gray-900">Developer</a><!--]--></div></div> <div class="flex items-center space-x-1"><a href="https://github.com/jokk-itu/authserver" target="_blank"><img src="../github.svg" alt="Github" height="20px" width="20px"/></a></div></div></div></nav><!----> <main class="container px-4 sm:mx-auto mt-8"><div class="w-full"><!--[--><!--[--><!----><div class="flex"><nav class="hidden lg:block sm:flex-none mx-4 w-56 rounded-md outline-8"><ul class="rounded-md [&amp;>li]:px-4 py-4 space-y-4 text-lg bg-zinc-200"><!--[--><li class="hover:underline"><a href="/authserver/developer/architecture">Architecture</a></li><li class="hover:underline"><a href="/authserver/developer/setup">Setup</a></li><li class="hover:underline"><a href="/authserver/developer/client-authentication">Client Authentication</a></li><li class="hover:underline"><a href="/authserver/developer/discovery">Discovery</a></li><li class="hover:underline"><a href="/authserver/developer/jwks">JWKS</a></li><li class="hover:underline"><a href="/authserver/developer/pkce">PKCE</a></li><li class="hover:underline"><a href="/authserver/developer/subject-type">Subject Type</a></li><li class="hover:underline"><a href="/authserver/developer/resource">Resource</a></li><li class="hover:underline"><a href="/authserver/developer/jar">JAR</a></li><li class="hover:underline"><a href="/authserver/developer/dpop">DPoP</a></li><li class="hover:underline"><a href="/authserver/developer/token">Token</a></li><li class="hover:underline"><a href="/authserver/developer/client-credentials">Client Credentials</a></li><li class="hover:underline"><a href="/authserver/developer/authorization-code">Authorization Code</a></li><li class="hover:underline"><a href="/authserver/developer/refresh-token">Refresh Token</a></li><li class="hover:underline"><a href="/authserver/developer/token-exchange">Token Exchange</a></li><li class="hover:underline"><a href="/authserver/developer/device-authorization">Device Authorization</a></li><li class="hover:underline"><a href="/authserver/developer/token-revocation">Token Revocation</a></li><li class="hover:underline"><a href="/authserver/developer/token-introspection">Token Introspection</a></li><li class="hover:underline"><a href="/authserver/developer/grant-management">Grant Management</a></li><!--]--></ul></nav> <div class="flex-auto w-full overflow-auto"><!--[--><!----><h1 class="text-4xl mb-2">Token Exchange</h1> <hr class="mb-4"/><!----> <div class="mb-8" id="introduction"><div class="inline-flex"><a class="hover:underline ref-link text-xl" href="#introduction">Introduction</a></div> <hr class="mb-4"/> <!--[--><p>The token exchange grant type is used to exchange a token for another one.
        There are several use cases for this, where one can exchange one type of token for another one,
        or decrease/replace authorization of a token.</p> <br/> <p>Token Exchange can happen in two forms: Impersonation or Delegation.</p> <p>A client can impersonate another client by requesting a token exchange,
        and act as the client, and there is no trace of impersonation in the exchanged token.</p> <p>A client can be delegated access from another client, by request a token exchange,
        and link a token to the exchanged token, thereby tracing that the token has been exchanged.</p><!--]--></div><!----> <div class="mb-8" id="specifications"><div class="inline-flex"><a class="hover:underline ref-link text-xl" href="#specifications">Specifications</a></div> <hr class="mb-4"/> <!--[--><div class="w-full overflow-x-auto"><table class="border-collapse table-fixed sm:table-auto w-full text-sm"><caption class="caption-bottom">Table 1: Specifications</caption><thead class="bg-openid"><tr><!--[--><th class="break-words border font-medium text-lg p-4 pl-8 pt-3 pb-3 text-left">Name</th><th class="break-words border font-medium text-lg p-4 pl-8 pt-3 pb-3 text-left">Description</th><!--]--></tr></thead><tbody class="bg-white"><!--[--><tr><!--[--><!--[--><td class="break-words border border-slate-200 p-4 pl-8"><a href="https://datatracker.ietf.org/doc/html/rfc8693" class="underline decoration-2 hover:decoration-openid">Token Exchange</a></td><!--]--><!--[!--><td class="break-words border border-slate-200 p-4 pl-8">Specification to exchange tokens</td><!--]--><!--]--></tr><!--]--></tbody></table></div><!--]--></div><!----> <div class="mb-8" id="restrictions and extensions"><div class="inline-flex"><a class="hover:underline ref-link text-xl" href="#restrictions and extensions">Restrictions and Extensions</a></div> <hr class="mb-4"/> <!--[--><p>Only confidential clients are are eligible for token exchange, as it requires client authentication.</p> <p>Only access_token and id_token can be used as subject, actor and requested tokens.</p> <p>Only tokens from AuthServer are allowed to participate in token exchange.</p> <p>The act claim is not nested, and does not allow for tracing a full transaction of multiple token exchanges.</p> <br/> <p>Validation can be extended by implementing the interface "IExtendedTokenExchangeRequestValidator".</p><!--]--></div><!----> <div class="mb-8" id="token endpoint"><div class="inline-flex"><a class="hover:underline ref-link text-xl" href="#token endpoint">Token endpoint</a></div> <hr class="mb-4"/> <!--[--><p>If the parameter "grant_type" is passed with value "urn:ietf:params:oauth:grant-type:token-exchange" to the token endpoint, then a subject_token is exchanged for a requested token.</p> <p>The subject_token is used to exchange it for a new token, which is passed in the "access_token" field.
        The specific type of token is defined by the requestor, in the field "requested_token_type",
        and is also set in the response field "issued_token_type".</p> <p>The following is an example HTTP request using token exchange.</p> <div class="w-full overflow-x-auto"><div class="outline-solid bg-gray-900 border-slate-600 border-4 rounded-lg my-8"><pre class="whitespace-pre p-4 flex overflow-x-auto leading-6">
            <code class="text-white pe-16">
                <!--[--><!---->
POST /connect/token HTTP/1.1
Host: idp.authserver.dk
Content-Type: application/x-www-form-urlencoded
Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW

grant_type=urn:ietf:params:oauth:grant-type:token-exchange
&amp;subject_token=eyJhbGciOiJSUzI1NiIsImtpZCI...
&amp;subject_token_type=urn:ietf:params:oauth:token-type:access_token
&amp;requested_token_type=urn:ietf:params:oauth:token-type:access_token
&amp;scope=account:update%20account:delete
&amp;resource=https%3A%2F%2Fapi-one.protectedresource.dk
&amp;resource=https%3A%2F%2Fapi-two.protectedresource.dk
<!--]-->
            </code>
        </pre></div></div><!----> <p>The following is an example HTTP response using token exchange.</p> <div class="w-full overflow-x-auto"><div class="outline-solid bg-gray-900 border-slate-600 border-4 rounded-lg my-8"><pre class="whitespace-pre p-4 flex overflow-x-auto leading-6">
            <code class="text-white pe-16">
                <!--[--><!---->
HTTP/1.1 200 BadRequest
Content-Type: application/json;charset=UTF-8
Cache-Control: no-cache, no-store

{
  "access_token":"eyJhbGciOiJSUzI1NiIsImtpZCI...",
  "expires_in": 300,
  "scope": "account:update account:delete",
  "token_type": "Bearer",
  "issued_token_type": "urn:ietf:params:oauth:token-type:access_token"
}
<!--]-->
            </code>
        </pre></div></div><!----><!--]--></div><!----> <div class="mb-8" id="decrease access"><div class="inline-flex"><a class="hover:underline ref-link text-xl" href="#decrease access">Decrease access</a></div> <hr class="mb-4"/> <!--[--><p>If a protected resource receives a token with a lot privileges,
        and the protected resource needs to send it downstream, but less privilege is needed.</p> <p>The protected resource can exchange the token with the least privilege required using token exchange.</p><!--]--></div><!----> <div class="mb-8" id="create access"><div class="inline-flex"><a class="hover:underline ref-link text-xl" href="#create access">Create access</a></div> <hr class="mb-4"/> <!--[--><p>If a protected resource receives a token that it needs to send downstream, but it is missing required privileges.</p> <p>The protected resource can exchange the token with the required privilege required using token exchange.</p><!--]--></div><!----> <div class="mb-8" id="impersonating an end user"><div class="inline-flex"><a class="hover:underline ref-link text-xl" href="#impersonating an end user">Impersonating an end user</a></div> <hr class="mb-4"/> <!--[--><p>Explain the use case of impersonating an end user and using the may_act claim.</p><!--]--></div><!----> <div class="mb-8" id="dpop bound exchanged token"><div class="inline-flex"><a class="hover:underline ref-link text-xl" href="#dpop bound exchanged token">DPoP bound exchanged token</a></div> <hr class="mb-4"/> <!--[--><p>Explain how to DPoP bound and how it works</p><!--]--></div><!----> <div class="mb-8" id="id token encryption"><div class="inline-flex"><a class="hover:underline ref-link text-xl" href="#id token encryption">Id token encryption</a></div> <hr class="mb-4"/> <!--[--><p>Explain that the client invoking the endpoint, is used as the encryptor for the id token.</p><!--]--></div><!----><!----><!--]--></div></div><!----><!--]--><!--]--></div></main> <footer><svg viewBox="0 0 1440 320" class="fill-openid" xmlns="http://www.w3.org/2000/svg"><path fill-opacity="1" d="M0,128L34.3,112C68.6,96,137,64,206,74.7C274.3,85,343,139,411,149.3C480,160,549,128,617,106.7C685.7,85,754,75,823,96C891.4,117,960,171,1029,181.3C1097.1,192,1166,160,1234,165.3C1302.9,171,1371,213,1406,234.7L1440,256L1440,320L1405.7,320C1371.4,320,1303,320,1234,320C1165.7,320,1097,320,1029,320C960,320,891,320,823,320C754.3,320,686,320,617,320C548.6,320,480,320,411,320C342.9,320,274,320,206,320C137.1,320,69,320,34,320L0,320Z"></path></svg> <div class="bg-gray-800 text-white py-4"><div class="container mx-auto text-center"><p>2025 AuthServer. All rights reserved.</p></div></div></footer><!----><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_prsgfk = {
						base: new URL("..", location).pathname.slice(0, -1),
						assets: "/authserver"
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../_app/immutable/entry/start.CW53oebm.js"),
						import("../_app/immutable/entry/app.DkWigvru.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2, 22],
							data: [null,null,null],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>