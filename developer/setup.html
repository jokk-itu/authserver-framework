<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../favicon.png" />
		<meta name="viewport" content="width=device-width" />
		<meta name="author" content="Joachim KÃ¸cher Kelsen" />
		
		<link href="../_app/immutable/assets/0.DeOGtgbP.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.CXq2a9eL.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DdgwZPnp.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Db0b_LWK.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/QbF3iSUJ.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DbJvz8S3.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.Dfsb8umK.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/C9f0ZI4H.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BdD32qd5.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CUjF3E6N.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BpXGYBMw.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.Bdopcn5l.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BOyCDzPS.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CANx_FtO.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BweDwWPv.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/B1GS75aA.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/hXpMuBZJ.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/2.C0DLixt9.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/14.69bZTcTf.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Dg6GzD5d.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DcIxqC40.js"><!--[--><!--]--><title>IdentityProvider setup overview</title>
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents"><!--[--><!--[--><!----><nav class="backdrop-saturate-200 backdrop-blur-md z-50 flex fixed top-0 bottom-0 left-0 right-0 overflow-y-auto hidden"><div class="w-full min-h-full max-w-80 bg-zinc-200"><div class="px-4 pt-6"><button aria-label="Close mobile menu"><svg class="w-4 h-4" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <div><ul class="rounded-md [&amp;>li]:px-4 py-4 space-y-4 text-lg"><!--[--><li class="hover:underline"><a href="/authserver/intro">Intro</a></li><li class="hover:underline"><a href="/authserver/demo">Demo</a></li><li class="hover:underline"><a href="/authserver/developer">Developer</a></li><!--]--> <!--[--><li class="hover:underline"><a href="/authserver/developer/architecture">Architecture</a></li><li class="hover:underline"><a href="/authserver/developer/datamodel">Datamodel</a></li><li class="hover:underline"><a href="/authserver/developer/setup">Setup</a></li><li class="hover:underline"><a href="/authserver/developer/client-authentication">Client Authentication</a></li><li class="hover:underline"><a href="/authserver/developer/discovery">Discovery</a></li><li class="hover:underline"><a href="/authserver/developer/jwks">JWKS</a></li><li class="hover:underline"><a href="/authserver/developer/token">Token</a></li><li class="hover:underline"><a href="/authserver/developer/client-credentials">Client Credentials</a></li><li class="hover:underline"><a href="/authserver/developer/authorization-code">Authorization Code</a></li><li class="hover:underline"><a href="/authserver/developer/refresh-token">Refresh Token</a></li><!--]--></ul></div></div></nav> <nav class="bg-gray-100 py-5"><div class="max-w-7xl mx-auto px-4"><div class="items-center flex justify-between"><div class="flex space-x-4"><button class="lg:hidden" aria-label="Open mobile menu"><svg viewBox="0 0 24 24" class="w-4 h-4"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg></button> <div class="hidden lg:block"><a href="../" class="flex items-center text-gray-700 hover:text-gray-900"><svg class="h-6 w-6 mr-1 fill-openid" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.54 .887L10.91 2.66V20.83C6.76 20.31 3.64 18.05 3.64 15.33C3.64 12.75 6.44 10.58 10.27 9.92V7.61C4.42 8.32 0 11.5 0 15.33C0 19.29 4.74 22.57 10.91 23.11L14.54 21.4V.886M15.18 7.61V9.92C16.61 10.17 17.89 10.62 18.94 11.23L16.97 12.34L24 13.87L23.5 8.66L21.63 9.72C19.89 8.66 17.67 7.91 15.18 7.61Z"></path></svg> <span class="font-bold">AuthServer</span></a><!----></div></div> <div class="flex items-center space-x-1"><div class="block lg:hidden"><a href="../" class="flex items-center text-gray-700 hover:text-gray-900"><svg class="h-6 w-6 mr-1 fill-openid" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.54 .887L10.91 2.66V20.83C6.76 20.31 3.64 18.05 3.64 15.33C3.64 12.75 6.44 10.58 10.27 9.92V7.61C4.42 8.32 0 11.5 0 15.33C0 19.29 4.74 22.57 10.91 23.11L14.54 21.4V.886M15.18 7.61V9.92C16.61 10.17 17.89 10.62 18.94 11.23L16.97 12.34L24 13.87L23.5 8.66L21.63 9.72C19.89 8.66 17.67 7.91 15.18 7.61Z"></path></svg> <span class="font-bold">AuthServer</span></a><!----></div> <div class="hidden lg:block"><!--[--><a href="/authserver/intro" class="px-3 text-gray-700 hover:text-gray-900">Intro</a><a href="/authserver/demo" class="px-3 text-gray-700 hover:text-gray-900">Demo</a><a href="/authserver/developer" class="px-3 text-gray-700 hover:text-gray-900">Developer</a><!--]--></div></div> <div class="flex items-center space-x-1"><a href="https://github.com/jokk-itu/authserver" target="_blank"><img src="../github.svg" alt="Github" height="20px" width="20px"></a></div></div></div></nav><!----> <main class="container px-4 sm:mx-auto mt-8"><div class="w-full"><!----><!--[--><!----><div class="flex"><nav class="hidden lg:block sm:flex-none mx-4 w-56 rounded-md outline-8"><ul class="rounded-md [&amp;>li]:px-4 py-4 space-y-4 text-lg bg-zinc-200"><!--[--><li class="hover:underline"><a href="/authserver/developer/architecture">Architecture</a></li><li class="hover:underline"><a href="/authserver/developer/datamodel">Datamodel</a></li><li class="hover:underline"><a href="/authserver/developer/setup">Setup</a></li><li class="hover:underline"><a href="/authserver/developer/client-authentication">Client Authentication</a></li><li class="hover:underline"><a href="/authserver/developer/discovery">Discovery</a></li><li class="hover:underline"><a href="/authserver/developer/jwks">JWKS</a></li><li class="hover:underline"><a href="/authserver/developer/token">Token</a></li><li class="hover:underline"><a href="/authserver/developer/client-credentials">Client Credentials</a></li><li class="hover:underline"><a href="/authserver/developer/authorization-code">Authorization Code</a></li><li class="hover:underline"><a href="/authserver/developer/refresh-token">Refresh Token</a></li><!--]--></ul></nav> <div class="flex-auto w-full"><!----><!----><h1 class="text-4xl mb-2">Setup</h1> <hr class="mb-4"><!----> <div class="mb-8" id="introduction"><div class="inline-flex"><a class="hover:underline ref-link text-xl" href="#introduction">Introduction</a></div> <hr class="mb-4"> <!----><p>The following sections describe how to setup AuthServer framework in
        your solution. <br> The example code is written for an AspNetCore WebApp in .NET 8.</p><!----></div><!----> <div class="mb-8" id="options"><div class="inline-flex"><a class="hover:underline ref-link text-xl" href="#options">Options</a></div> <hr class="mb-4"> <!----><p>The JwksDocument is responsible for defining keys for signing and
        encrypting tokens. There must only be registered one key per algorithm.</p> <div class="w-full overflow-x-auto"><div class="outline-solid bg-gray-900 border-slate-600 border-4 rounded-lg my-8"><pre class="whitespace-pre p-4 flex overflow-x-auto leading-6">            <code class="text-white pe-16">
                <!----><!---->
            // Inside Program.cs
            using AuthServer.Options;
            using AuthServer.Enums;
                            
            var builder = WebApplication.CreateBuilder(args);
            var rsa = RSA.Create(3072);
            var rsaSecurityKey = new RsaSecurityKey(rsa)
            {
                KeyId = Guid.NewGuid().ToString();
            };
            builder.Services.AddOptions&lt;JwksDocument>(options =>
            {
                options.SigningKeys = [rsaSecurityKey, new SigningKey(SigningAlg.RsaSha256)];
                options.GetTokenSigningKey = () => options.SigningKeys.Single();
            });
        <!---->
            </code>
        </pre></div></div><!----> <p>The DiscoveryDocument is responsible for defining metadata about your
        AuthServer instance. It is only customizable properties that are
        exposed, as some are internally handled.</p> <div class="w-full overflow-x-auto"><div class="outline-solid bg-gray-900 border-slate-600 border-4 rounded-lg my-8"><pre class="whitespace-pre p-4 flex overflow-x-auto leading-6">            <code class="text-white pe-16">
                <!----><!---->
            // Inside Program.cs
            using AuthServer.Options;
            
            var builder = WebApplication.CreateBuilder(args);
            builder.Services.AddOptions&lt;DiscoveryDocument>(options =>
            {
                options.Issuer = "https://idp.authserver.dk";
                options.ClaimsSupported = ["name", "address", "roles"];
                options.Scopes = ["openid", "profile"];
            });
        <!---->
            </code>
        </pre></div></div><!----> <p>The UserInteraction is responsible for defining URL's for AuthServer to
        redirect to, when processing OpenId Connect requests. For example, when
        redirecting from the authorize endpoint or the end-session endpoint.</p> <div class="w-full overflow-x-auto"><div class="outline-solid bg-gray-900 border-slate-600 border-4 rounded-lg my-8"><pre class="whitespace-pre p-4 flex overflow-x-auto leading-6">            <code class="text-white pe-16">
                <!----><!---->
            // Inside Program.cs
            using AuthServer.Options;
            
            var builder = WebApplication.CreateBuilder(args);
            builder.Services.AddOptions&lt;UserInteraction>(options =>
            {
                options.AccountSelectionUri = "https://idp.authserver.dk/select-account";
                options.ConsentUri = "https://idp.authserver.dk/consent";
                options.LoginUri = "https://idp.authserver.dk/login";
                options.EndSessionUri = "https://idp.authserver.dk/logout";
            });
        <!---->
            </code>
        </pre></div></div><!----><!----></div><!----> <div class="mb-8" id="feature management"><div class="inline-flex"><a class="hover:underline ref-link text-xl" href="#feature management">Feature management</a></div> <hr class="mb-4"> <!----><p>The modules in AuthServer are built to be dynamically turned on or off
        during runtime. This is handled through the library
        Microsoft.FeatureManagement.</p> <div class="w-full overflow-x-auto"><div class="outline-solid bg-gray-900 border-slate-600 border-4 rounded-lg my-8"><pre class="whitespace-pre p-4 flex overflow-x-auto leading-6">            <code class="text-white pe-16">
                <!----><!---->
            // Inside appsettings.json
            {
              "FeatureManagement": {
                "TokenIntrospection": true,
                "TokenRevocation": true,
                "AuthorizationCode": true,
                "RefreshToken": true,
                "ClientCredentials": true,
                "Userinfo": true,
                "GrantManagementRevoke": true,
                "GrantManagementQuery": true,
                "RegisterGet": true,
                "RegisterDelete": true,
                "RegisterPut": true,
                "RegisterPost": true,
                "EndSession": true,
                "PushedAuthorization": true,
                "Authorize": true,
                "Discovery": true,
                "Jwks": true
              }
            }
        <!---->
            </code>
        </pre></div></div><!----><!----></div><!----> <div class="mb-8" id="automatic cleanup"><div class="inline-flex"><a class="hover:underline ref-link text-xl" href="#automatic cleanup">Automatic cleanup</a></div> <hr class="mb-4"> <!----><p>Some tables can grow very large over time, and it is therefore important to cleanup rows that cannot be used anymore.
        There exist BackgroundServices to automatically cleanup rows for Session, AuthorizationGrant and Token tables.
        Rows being deleted are only revoked or expired.
        These services can be configured using the following options fields.</p> <div class="w-full overflow-x-auto"><div class="outline-solid bg-gray-900 border-slate-600 border-4 rounded-lg my-8"><pre class="whitespace-pre p-4 flex overflow-x-auto leading-6">            <code class="text-white pe-16">
                <!----><!---->
            // Inside Program.cs
            using AuthServer.Options;

            var builder = WebApplication.CreateBuilder(args);
            builder.Services.AddOptions&lt;CleanupOptions>(options =>
            {
                options.RunSessionCleanup = true;
                options.SessionCleanupIntervalInSeconds = 5;
                options.SessionCleanupBatchSize = 100;

                options.RunAuthorizationGrantCleanup = true;
                options.AuthorizationGrantCleanupIntervalInSeconds = 5;
                options.AuthorizationGrantCleanupBatchSize = 100;

                options.RunTokenCleanup = true;
                options.RunTokenCleanupIntervalInSeconds = 5;
                options.RunTokenCleanupBatchSize = 100;
            });
        <!---->
            </code>
        </pre></div></div><!----><!----></div><!----> <div class="mb-8" id="interfaces"><div class="inline-flex"><a class="hover:underline ref-link text-xl" href="#interfaces">Interfaces</a></div> <hr class="mb-4"> <!----><p>The interface IDistributedCache in namespace AuthServer.Cache.Abstractions must be implemented.
        Its purpose is to act as a distributed cache for multi instance deployments.
        If you only have a single instance, then an in-memory cache implementation is sufficient.
        The cache only contains keys and values.</p> <p>The interface IUserClaimService in namespace AuthServer.Authentication.Abstractions must be implemented.
        Its purpose is to return end user's claims, such that they can be used in tokens and at the userinfo endpoint.
        This should connect to your datastore, where you persist information about end users.</p> <p>The interface IAuthenticatedUserAccessor in namespace AuthServer.Authentication.Abstractions must be implemented.
        Its purpose is to provide access to currently authenticated identities, in the user's browser.
        This is needed to determine if SSO can be performed, or if the user must choose which identity to login with.
        This can be implemented using the cookie authentication handler provided through AspNet.Core.</p> <p>The interface IAuthenticationContextReferenceResolver in namespace AuthServer.Authorize.Abstractions must be implemented.
        Its purpose is to return a AuthenticationContextReference from an AuthenticationMethodReference.</p><!----></div><!----> <div class="mb-8" id="startup"><div class="inline-flex"><a class="hover:underline ref-link text-xl" href="#startup">Startup</a></div> <hr class="mb-4"> <!----><p>The following example shows how to add services for AuthServer, and how
        to setup AuthServer in the AspNetCore HTTP request pipeline.</p> <div class="w-full overflow-x-auto"><div class="outline-solid bg-gray-900 border-slate-600 border-4 rounded-lg my-8"><pre class="whitespace-pre p-4 flex overflow-x-auto leading-6">            <code class="text-white pe-16">
                <!----><!---->
            // Inside Program.cs
            var builder = WebApplication.CreateBuilder(args);
            builder.Services.AddAuthServer();
            
            var app = builder.Build();
            
            // The invocation must occur after Authorization
            app.UseAuthServer();
            
            app.Run();
        <!---->
            </code>
        </pre></div></div><!----><!----></div><!----> <div class="mb-8" id="database"><div class="inline-flex"><a class="hover:underline ref-link text-xl" href="#database">Database</a></div> <hr class="mb-4"> <!----><p>Once migrations have been created and applied to the database, the
        initial data must be added.</p> <br> <p>AuthenticationContextReferences must be added. The following example
        inserts a single row in the AuthenticationContextReference table.</p> <div class="w-full overflow-x-auto"><div class="outline-solid bg-gray-900 border-slate-600 border-4 rounded-lg my-8"><pre class="whitespace-pre p-4 flex overflow-x-auto leading-6">            <code class="text-white pe-16">
                <!----><!---->
            INSERT INTO AuthenticationContextReference ([Name])
            VALUES ('urn:authserver:loa:low')
        <!---->
            </code>
        </pre></div></div><!----> <p>The IdentityProvider must be added. The following example inserts
        AuthServer as a client, and authorizes AuthServer to receive tokens with
        scopes.</p> <div class="w-full overflow-x-auto"><div class="outline-solid bg-gray-900 border-slate-600 border-4 rounded-lg my-8"><pre class="whitespace-pre p-4 flex overflow-x-auto leading-6">            <code class="text-white pe-16">
                <!----><!---->
            INSERT INTO Client (
                Id, [Name], ClientUri, ApplicationType, 
                TokenEndpointAuthMethod, TokenEndpointAuthSigningAlg,
                CreatedAt, AccessTokenExpiration, DPoPNonceExpiration, RequireConsent,
                RequirePushedAuthorizationRequests, RequireReferenceToken,
                RequireSignedRequestObject, RequireIdTokenClaims, RequireDPoPBoundAccessTokens)
            VALUES (
                NEWID(), 'authserver', 'https://idp.authserver.dk',
                0, 0, 0, GETUTCDATE(), 0, 0, 0, 0, 0, 0, 0, 0)
            
            DECLARE @ClientId UNIQUEIDENTIFIER = SCOPE_IDENTITY()
            
            INSERT INTO ClientScope (ClientId, ScopeId)
            VALUES
                (@ClientId, 7), -- authserver:userinfo
                (@ClientId, 9), -- grant_management_query
                (@ClientId, 10) -- grant_management_revoke
        <!---->
            </code>
        </pre></div></div><!----> <p>Custom Scopes must be added. The following example inserts a single row
        in the Scope table.</p> <div class="w-full overflow-x-auto"><div class="outline-solid bg-gray-900 border-slate-600 border-4 rounded-lg my-8"><pre class="whitespace-pre p-4 flex overflow-x-auto leading-6">            <code class="text-white pe-16">
                <!----><!---->
            INSERT INTO Scope (Name)
            VALUES ('value:of:custom:scope')
        <!---->
            </code>
        </pre></div></div><!----><!----></div><!----><!----><!----></div></div><!----><!--]--><!----></div></main> <footer><svg viewBox="0 0 1440 320" class="fill-openid" xmlns="http://www.w3.org/2000/svg"><path fill-opacity="1" d="M0,128L34.3,112C68.6,96,137,64,206,74.7C274.3,85,343,139,411,149.3C480,160,549,128,617,106.7C685.7,85,754,75,823,96C891.4,117,960,171,1029,181.3C1097.1,192,1166,160,1234,165.3C1302.9,171,1371,213,1406,234.7L1440,256L1440,320L1405.7,320C1371.4,320,1303,320,1234,320C1165.7,320,1097,320,1029,320C960,320,891,320,823,320C754.3,320,686,320,617,320C548.6,320,480,320,411,320C342.9,320,274,320,206,320C137.1,320,69,320,34,320L0,320Z"></path></svg> <div class="bg-gray-800 text-white py-4"><div class="container mx-auto text-center"><p>2025 AuthServer. All rights reserved.</p></div></div></footer><!----><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_1z0d0t9 = {
						base: new URL("..", location).pathname.slice(0, -1),
						assets: "/authserver"
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../_app/immutable/entry/start.CXq2a9eL.js"),
						import("../_app/immutable/entry/app.Dfsb8umK.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2, 14],
							data: [null,null,null],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>